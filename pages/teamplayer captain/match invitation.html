<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Match invitation</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="../../assets/css/overall.css">
	<link rel="stylesheet" href="../../assets/css/commonheader.css">
</head>

<body>
<!-- header start -->
<header class="match-invitation-header">
	<a onclick="previousPage()"><i class="fa-solid fa-arrow-left"></i></a>
	 <h1>Match Invitation</h1>
</header>
<!-- header end -->
<!-- main start -->
<section class="match-invitation-main">
		<!-- <div class="invitation">
			<div class="invitation-one">
				<div class="teamimgdiv">
					<img src="../../assets/images/team profile image/team2profile.jpg" alt="teamprofile">
				</div>
				<div class="teamnamediv">
					<div>
						<div><h2>Avengers11</h2></div>
						<div>
							<p class="frnd">Friend</p></div>
					</div>
					
				</div>
			</div>
			<div class="invitation-two">
				<div>
					<p>Type</p>
					<p>Betting Match</p>
				</div>
				<div>
					<p>Time</p>
					<p>22-Nov-2022 | 15:00</p>
				</div>
			</div>
			<div class="invitation-three">
				
				<div>
					<i class="fa-regular fa-copyright"></i>
					<p>MSD</p>
				</div>
				<div>
					<i class="fa-solid fa-people-group"></i>
					<p>10 Members (Age : 19 to 22)</p>
				</div>
				<div>
					<i class="fa-solid fa-location-dot"></i>
					<p>Chennai, Annanagar, Cresent ground</p>
				</div>
				<div>
					<i class="fa-solid fa-circle-info"></i>	
					<p>Rubber ball match, betting amount per match 100rs</p>
				</div>
			</div>
			<div class="accept-reject">
				<button>Reject</button>
				<button>Accept</button>
			</div>
			<div class="invitation-four">
				<div class="timetaken">
					<i class="fa-regular fa-clock"></i>
					<p>1 hour ago</p>
				</div>
			</div>
		</div> -->


</section>
<script src="../../lib/moment/moment.min.js"></script>

<script>

// for friend list start

const queryString = window.location.search;

const urlParams = new URLSearchParams(queryString);

const phonenumber = urlParams.get('unique_id');

let team_list = JSON.parse(localStorage.getItem('team_details_list'));

let players_list = JSON.parse(localStorage.getItem('user_detail'));

function findPlayer(a) {
let index = a.teamMembers.indexOf(phonenumber);
return a.teamMembers[index] == phonenumber ;
}

let teamProfile = team_list.find(findPlayer);

let my_team_id = teamProfile["uniqueId"]

let match_list = JSON.parse(localStorage.getItem('match_list'));

let request_list = JSON.parse(localStorage.getItem('match_response_list'))

let match_request_list = request_list.filter(e => e.team_id == my_team_id && e.match_in_status == 2);

console.log(match_request_list)

let matchInvitaton = []

for(let i=0; i<match_request_list.length; i++){
	let check = match_request_list[i]["matchUniqueId"]
	let find = match_list.find(e => e.matchUniqueId == check && e.activeStatus == true)
	if(find){
	matchInvitaton.push(find)
	}
}


console.log(matchInvitaton)


// for public list end

// console.log(public_data)


// [{}]   // filtered 

// [{}, {}]   // area filtered

// [ {}, {}, {} ]  = [  ...arr1, ...arr2 ]


// new Set(), new Map()






for(i=0;i< matchInvitaton.length ;i++){

let opponent_team_id = request_list.find(e => e.matchUniqueId == matchInvitaton[i]["matchUniqueId"] && e.match_in_status == 1)

let opponent_team_object = team_list.find(e => e.uniqueId == opponent_team_id["team_id"])

const div_class_invitation = document.createElement("div");
div_class_invitation.setAttribute("class", "invitation");


// div one

const div_class_invitation_one = document.createElement("div");
div_class_invitation_one.setAttribute("class", "invitation-one");
div_class_invitation.prepend(div_class_invitation_one);

const team_img_div = document.createElement("div");
team_img_div.setAttribute("class", "teamimgdiv");
div_class_invitation_one.prepend(team_img_div);

const team_image = document.createElement("img");
team_image.setAttribute("src", opponent_team_object["teamImageUrl"]);
team_image.setAttribute("alt", opponent_team_object["teamName"]);
team_img_div.prepend(team_image);

const team_name_div = document.createElement("div");
team_name_div.setAttribute("class", "teamnamediv");
div_class_invitation_one.append(team_name_div);

const team_name_subdiv = document.createElement("div");
team_name_subdiv.setAttribute("class", "teamnamesubdiv");
team_name_div.append(team_name_subdiv);

const team_name_subdivnthchild1 = document.createElement("div");
team_name_subdiv.prepend(team_name_subdivnthchild1);

const team_name_subdiv_header = document.createElement("h2");
team_name_subdiv_header.innerText = opponent_team_object["teamName"]
team_name_subdivnthchild1.append(team_name_subdiv_header);

const team_name_subdivnthchild2 = document.createElement("div");
team_name_subdiv.append(team_name_subdivnthchild2);


let friend = ''
let class_type = ''

if(matchInvitaton[i]["friendType"] == 1){
	 friend = 'Friend'
	 class_type = "frnd"
}
if(matchInvitaton[i]["friendType"] == 2){
	 friend = 'Public'
	 class_type = "public"

}

const team_name_subdiv_para = document.createElement("p");
team_name_subdiv_para.setAttribute("class", class_type);
team_name_subdiv_para.innerText = friend
team_name_subdivnthchild2.append(team_name_subdiv_para);

// div two

const div_class_invitation_two = document.createElement("div");
div_class_invitation_two.setAttribute("class", "invitation-two");
div_class_invitation.append(div_class_invitation_two);


const div_class_invitation_two_subdiv1 = document.createElement("div");
div_class_invitation_two.prepend(div_class_invitation_two_subdiv1);

const team_name_subdiv_typeheader = document.createElement("p");
team_name_subdiv_typeheader.innerText = "Type"
div_class_invitation_two_subdiv1.append(team_name_subdiv_typeheader);

const team_name_subdiv_typevalue = document.createElement("p");
team_name_subdiv_typevalue.innerText = matchInvitaton[i]["typeOfMatch"]
div_class_invitation_two_subdiv1.append(team_name_subdiv_typevalue);

const div_class_invitation_two_subdiv2 = document.createElement("div");
div_class_invitation_two.append(div_class_invitation_two_subdiv2);

const team_name_subdiv_timeheader = document.createElement("p");
team_name_subdiv_timeheader.innerText = "Time"
div_class_invitation_two_subdiv2.append(team_name_subdiv_timeheader);

const team_name_subdiv_timevalue = document.createElement("p");

let match_time = matchInvitaton[i]["time"]

team_name_subdiv_timevalue.innerText = moment(match_time).add(0, 'days').calendar()
div_class_invitation_two_subdiv2.append(team_name_subdiv_timevalue);

// div three

const div_class_invitation_three = document.createElement("div");
div_class_invitation_three.setAttribute("class", "invitation-three");
div_class_invitation.append(div_class_invitation_three);

const div_class_invitation_three_subdiv1 = document.createElement("div");
div_class_invitation_three.append(div_class_invitation_three_subdiv1);

const div_class_invitation_three_icon1 = document.createElement("i");
div_class_invitation_three_icon1.setAttribute("class", "fa-regular fa-copyright");
div_class_invitation_three_subdiv1.append(div_class_invitation_three_icon1);

let captain = ""

for(let j=0 ; j<opponent_team_object["teamMembers"].length; j++){
	let a = opponent_team_object["teamMembers"][j] 

	let find = players_list.find(e => e.phoneNumber == a)

	if(find["captainStatus"] == 1){
		captain = find["userName"] ;
	}

}
const div_class_invitation_three_para1 = document.createElement("p");
div_class_invitation_three_para1.innerText = captain //not enter
div_class_invitation_three_subdiv1.append(div_class_invitation_three_para1);

const div_class_invitation_three_subdiv2 = document.createElement("div");
div_class_invitation_three.append(div_class_invitation_three_subdiv2);

const div_class_invitation_three_icon2 = document.createElement("i");
div_class_invitation_three_icon2.setAttribute("class", "fa-solid fa-people-group");
div_class_invitation_three_subdiv2.append(div_class_invitation_three_icon2);

const div_class_invitation_three_para2 = document.createElement("p");
div_class_invitation_three_para2.innerText = matchInvitaton[i]["members"] + "  Members" + " (Age :" + matchInvitaton[i]["membersAge"]["from"] + " to " + matchInvitaton[i]["membersAge"]["to"] + ")";
div_class_invitation_three_subdiv2.append(div_class_invitation_three_para2);

const div_class_invitation_three_subdiv3 = document.createElement("div");
div_class_invitation_three.append(div_class_invitation_three_subdiv3);

const div_class_invitation_three_icon3 = document.createElement("i");
div_class_invitation_three_icon3.setAttribute("class", "fa-solid fa-location-dot");
div_class_invitation_three_subdiv3.append(div_class_invitation_three_icon3);

const div_class_invitation_three_para3 = document.createElement("p");
div_class_invitation_three_para3.innerText = matchInvitaton[i]["location"]
div_class_invitation_three_subdiv3.append(div_class_invitation_three_para3);

const div_class_invitation_three_subdiv4 = document.createElement("div");
div_class_invitation_three.append(div_class_invitation_three_subdiv4);

const div_class_invitation_three_icon4 = document.createElement("i");
div_class_invitation_three_icon4.setAttribute("class", "fa-solid fa-circle-info");
div_class_invitation_three_subdiv4.append(div_class_invitation_three_icon4);

const div_class_invitation_three_para4 = document.createElement("p");
div_class_invitation_three_para4.innerText = matchInvitaton[i]["information"]
div_class_invitation_three_subdiv4.append(div_class_invitation_three_para4);

// accept reject btn

const div_accept_reject = document.createElement("div");
div_accept_reject.setAttribute("class", "accept-reject");
div_class_invitation.append(div_accept_reject);

const div_reject_button = document.createElement("button");
div_reject_button.innerText = "Reject"
div_reject_button.setAttribute("type", "button");
div_reject_button.setAttribute("class", "reject-btn");
div_reject_button.setAttribute("data-id", matchInvitaton[i]["matchUniqueId"]);
div_accept_reject.append(div_reject_button);

const div_accept_button = document.createElement("button");
div_accept_button.innerText = "Accept"
div_accept_button.setAttribute("type", "button");
div_accept_button.setAttribute("class", "accept-btn");
div_accept_button.setAttribute("data-id", matchInvitaton[i]["matchUniqueId"]);
div_accept_reject.append(div_accept_button);

// div four

const div_class_invitation_four = document.createElement("div");
div_class_invitation_four.setAttribute("class", "invitation-four");
div_class_invitation.append(div_class_invitation_four);

const div_class_invitation_four_subdiv = document.createElement("div");
div_class_invitation_four_subdiv.setAttribute("class", "timetaken");
div_class_invitation_four.append(div_class_invitation_four_subdiv);

const div_class_invitation_four_i = document.createElement("i");
div_class_invitation_four_i.setAttribute("class", "fa-regular fa-clock");
div_class_invitation_four_subdiv.append(div_class_invitation_four_i);

const div_class_invitation_four_p = document.createElement("p");

let createdTime = matchInvitaton[i]["createdTime"] ;
div_class_invitation_four_p.innerText = moment(createdTime).startOf('sec').fromNow();
div_class_invitation_four_subdiv.append(div_class_invitation_four_p);

document.querySelector(".match-invitation-main").append(div_class_invitation)

}


let selectbtn = document.querySelectorAll(".accept-btn");
	selectbtn.forEach(each => {
      each.addEventListener("click", (event) => {
		const person_data =  match_list.find(game => game["matchUniqueId"] === each.dataset.id);

			person_data["activeStatus"] = false ;

			let person_response = request_list.find(e => e.matchUniqueId == each.dataset.id && e.team_id == my_team_id)

			console.log(person_response)

			person_response["match_in_status"] = 1 ;

			person_response["team_players"] = teamProfile["teamMembers"] ;
		
		localStorage.setItem('match_list', JSON.stringify(match_list));
		
		localStorage.setItem('match_response_list', JSON.stringify(request_list));

		location.reload();
	  })
	})

	let rejectbtn = document.querySelectorAll(".reject-btn");
	rejectbtn.forEach(each => {
      each.addEventListener("click", (event) => {
		const person_data = match_list.find(game => game["matchUniqueId"] === each.dataset.id);
		if(person_data["friendType"] == 1){
			person_data["activeStatus"] = false ;

			let person_response = request_list.find(e => e.matchUniqueId == each.dataset.id && e.team_id == my_team_id)

			person_response["match_in_status"] = 0 ;
		}
		if(person_data["friendType"] == 2){

			let person_response = request_list.find(e => e.matchUniqueId == each.dataset.id && e.team_id == my_team_id)

			person_response["match_in_status"] = 0 ;
		}
		localStorage.setItem('match_list', JSON.stringify(match_list));
		
		localStorage.setItem('match_response_list', JSON.stringify(request_list));

		location.reload();
	  })
	})

	function previousPage(){
	window.history.go(-1)
}
</script>

<!-- main end -->
</body>
</html>