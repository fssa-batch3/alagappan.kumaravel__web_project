<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Team profile</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="../../assets/css/profileview.css">
	<link rel="stylesheet" href="../../assets/css/update_score.css">
</head>

<body>

	<!-- header start -->
	<header>
		<!-- <img class="bgimg" src="../../assets/images/team1profile.jpg" alt="backgroundimage"> -->
		<div class="color"></div>
		<div class="top">
			<a onclick="previousPage()"><i class="fa-solid fa-arrow-left"></i></a>
			<div class="topleft">
				<i class="fa-solid fa-share"></i>
				<a onclick="teamEdit()" class="edit_team"><i class="fa-solid fa-pen"></i></a>
				<i class="fa-brands fa-whatsapp"></i>
			</div>
		</div>
		<div class="sidebar-profile">
				<div class="playerimagediv">
					<!-- <img src="../../assets/images/team1profile.jpg" alt="teamprofile"> -->
				</div>
				<div class="profiledetailsdiv">
					<h1></h1>
					<div>
						<i class="fa-solid fa-location-dot"></i>
						<p></p>
					</div>
					<div>
						<i class="fa-regular fa-calendar"></i>
						<p></p>
					</div>
				</div>
			</div>
	</header>
	<!-- header end -->
		<!-- main start -->
		<main>
			<div class="headerbottom">

				<button  type="button" onclick="member()">MEMBER</button>

				<button type="button" onclick="match()">MATCHES</button>

				<button type="button" onclick="profile()">PROFILE</button>
			<div class="button_underline"></div>
		</div>
		<section class="first">
			<div class="playermatch">
			</div>
		</section>
	<!-- main start -->
	<section class="second">
		<div class="completed">
			<!-- popup past result start -->
	<div class="popup" id="popup_result">
		<div class="popup-team-content">
			<div class="score_container">
				<div class="top">
					<div class="backgroundimage">
					<div class="score_head">
						<button type="button" onclick="ClosePopupResult()">
							<i class="fa-solid fa-chevron-left"></i></button>
						<h1>SCORECARD</h1>
					</div>
					<div class="team_score">
						<div class="team_name">
							<img class="my_team_image" id="past_my_team_img" src="" alt="my team image">
							<p class="my_team_name" id="past_my_team"></p>
						</div>
						<div class="score_value">	
							<h2>Matches</h2>
							<div class="score">
									<div>
										<p id="past_Won_score"></p>
										<p class="subname">Won</p>
									</div>
								
									<div>
										<p id="past_draw_score"></p>
										<p class="subname">Draw</p>
									</div>
								
									<div>
										<p id="past_loss_score"></p>
										<p class="subname">Loss</p>
									</div>
									
								</div>
						</div>
						<div class="team_name">
							<img class="opp_team_image" id="past_opp_team_img" src="" alt="opponent image">
							<p class="opp_team_name" id="past_opp_team"></p>
						</div>
					</div>
				</div>
				</div>
				<div class="bottom">
					<div class="result_nav">
						<button class="mvpbtn" type="button" onclick="pastMvp()">MVPs</button>
						<button class="playersbtn" type="button" onclick="pastPlayers()">Players</button>
						<button class="detailsbtn" type="button" onclick="pastDetails()">Details</button>
					</div>
	<!-- match details start -->
	<div class="past_match_details">
		<h3>Details</h3>
		<div class="details">
			<div>
				<i class="fa-regular fa-clock"></i>
				<p id="past_match_time"></p>
			</div>
			<div>
				<i class="fa-solid fa-shield-halved"></i>
				<p id="past_match_type"></p>
			</div>
			<div>
				<i class="fa-solid fa-location-dot"></i>
				<p id="past_match_location"></p>
			</div>
			<div>
				<i class="fa-solid fa-circle-info"></i>	
				<p id="past_match_info"></p>
			</div>
		</div>
	</div>
	
	<!-- match details end -->
	
	<!-- match players start -->
					<div class="past_match_players">
						<h3>Players</h3>
						<div class="members">
							<div class="my_team_players">
								<h4></h4>
								<div>
	
								</div>
							
	
							</div>
							<div class="opp_team_players">
								<h4></h4>
								<div>
	
								</div>
								<!-- <div class="players">
									<img src="../../assets/images/Avatar.png" alt="">
									<p>Madhav</p>
								</div>
	
								<div class="players">
									<img src="../../assets/images/Avatar.png" alt="">
									<p>Madhav</p>
								</div> -->
	
							</div>
						</div>
					</div>
	<!-- match players end -->
	
	<!-- match mvps start -->
					<div class="mvp_det">
							<table class="past_players_list">
								<caption>Most Valuble Players</caption>
								<thead>
								<tr>
									<th></th>
									<th>Players</th>
									<th>Team</th>
								  </tr></thead>
								  <tbody>
	
								  </tbody>
								  
							  </table>
		
					</div>
	<!-- match mvps end -->
	
	
				</div>
				
			</div>	
		</div>
	</div>
		<!-- popup past result end -->
		</div>
	</section>
	<section class="three">
		
		<div class="playerprofile">
			<table class="data">
				<caption></caption>
						<thead>
							<th>
								<td></td>
								<td></td>
								<td></td>
							</th>
						</thead>
			<tbody>
				<tr>
					<td>Area</td>
					<td class="area"></td>
				  </tr>
				  <tr>
					<td>Age</td>
					<td class="age"></td>
				  </tr>
				  <tr>
					<td>Members</td>
					<td class="member"></td>
				  </tr>
				  <tr>
					<td>About</td>
					<td class="about"></td>
				  </tr>
				  <tr>
					<td>Open for players</td>
					<td class="open_for_player"></td>
				  </tr>
			</tbody>
		  </table>
		</div>
		</section>
	</main>
	<!-- main end -->

	<script src="../../lib/moment/moment.min.js">

	</script>

<script>


const queryString = window.location.search;

const urlParams = new URLSearchParams(queryString);

const phonenumber = urlParams.get('unique_id');

let unique_id = phonenumber;

let team_list = JSON.parse(localStorage.getItem('team_details_list'));

let all_player_list = JSON.parse(localStorage.getItem('user_detail'));
let players_list = JSON.parse(localStorage.getItem('user_detail'));

let match_list = JSON.parse(localStorage.getItem('match_list'));

let request_list = JSON.parse(localStorage.getItem('match_response_list'))

let score_resopnse = JSON.parse(localStorage.getItem('score_card'));

// upto this common for all section

function findPlayer(a) {
let index = a.teamMembers.indexOf(unique_id);
return a.teamMembers[index] == unique_id ;
}

let teamProfile = team_list.find(findPlayer);

let team_id = teamProfile["uniqueId"]
let completed_match_list;
let completed_match = []
if(request_list != undefined){
completed_match_list = request_list.filter(e => e.match_in_status == 1 && e.team_id == team_id)
}

let unique_player = teamProfile["teamMembers"];

let team_players_list = []

for(i=0;i<unique_player.length;i++){

	let player_number = unique_player[i];

	function findPlayer(a) {
	return a.phoneNumber == player_number ;
	}	

	let player_object = all_player_list.find(findPlayer);

	team_players_list.push(player_object)

}

let my_profile = team_players_list.find(e => e.phoneNumber == unique_id)

console.log(my_profile)
if(my_profile["captainStatus"] == 0){
	document.querySelector(".edit_team").style.display = "none";
}

let players_age =[]

console.log(team_players_list)

for(i=0;i<team_players_list.length;i++){

let captain = "" ;
let whatsapp = "";
let me = ""

if(team_players_list[i]["captainStatus"] == 1){
	captain = "captain"
}
if(team_players_list[i]["phoneNumber"] == phonenumber && team_players_list[i]["captainStatus"] == 1){
    whatsapp = "";
	me = "(you)"
}

else if(team_players_list[i]["phoneNumber"] != phonenumber){
	whatsapp = '<i class="fa-brands fa-whatsapp"></i>'
}

else{
	whatsapp = '<a class="exit_from_team" onclick="exit()">EXIT</a>'
	me = "(you)"
}

let playerAge = team_players_list[i]["dateOFBirth"]
let dob = new Date(playerAge);
        let today = new Date();
        let age = today.getTime() - dob.getTime();
        age = Math.floor(age / (1000 * 60 * 60 * 24 * 365.25));
		players_age.push(age)

	const player = team_players_list[i];
	const template1 = renderPlayer(player, captain, whatsapp, me, age);
	document.querySelector(".playermatch").insertAdjacentHTML("beforeend", template1);

}

// here i find max and min of players of the age 

let max = Math.max(...players_age)
let min  = Math.min(...players_age)


function renderPlayer(player, captain, whatsapp, me, age) {  

const template1 = `	
	<div class="teams">
					<div class="teamimagediv">
						<img class="teamprofile playerimg" src="${player["imageUrl"]}" alt="Image of ${player["userName"]}">
					</div>
					<div class="teamdetaildiv playerdet">
						<div>
							<div><p class="playername">${player["userName"]}<b>${me} ${captain}</b></p></div>
							<div class="whatsapp">
								${whatsapp}
								</div>
						</div>
						<div class="matchdetails"><i class="fa-solid fa-calendar-week"></i>
							<p>${age}</p></div>
	
					</div>
				</div>
	`
return template1;
}


function exit(){
	if(confirm("Do you want to Exit from " + teamProfile["teamName"] + " team ?")){

		let my_profile = all_player_list.find(e => e.phoneNumber == phonenumber)

		my_profile["captainStatus"] = 2 ;

		let indexOfUser = teamProfile["teamMembers"].indexOf(my_profile["phoneNumber"]);

		teamProfile["teamMembers"].splice(indexOfUser, 1);

		localStorage.setItem('user_detail', JSON.stringify(all_player_list));
		localStorage.setItem('team_details_list', JSON.stringify(team_list));

		window.location.href = `../homepage/hpexist.html?unique_id=${phonenumber}`
	}
}

function member(){
    let toggle_button = document.querySelector(".button_underline");
	toggle_button.style.left = "0%";
    console.log("hi")

	let content_1 = document.querySelector("section.first")
	content_1.style.display = "block";

	let content_2 = document.querySelector("section.second")
	content_2.style.display = "none";

	let content_3 = document.querySelector("section.three")
	content_3.style.display = "none";
}
function match(){
    let toggle_button = document.querySelector(".button_underline");
	toggle_button.style.left = "33.3%";
	
	let content_1 = document.querySelector("section.first")
	content_1.style.display = "none";

	let content_2 = document.querySelector("section.second")
	content_2.style.display = "block";

	let content_3 = document.querySelector("section.three")
	content_3.style.display = "none";
}
function profile(){
    let toggle_button = document.querySelector(".button_underline");
	toggle_button.style.left = "66.6%";
	
	let content_1 = document.querySelector("section.first")
	content_1.style.display = "none";

	let content_2 = document.querySelector("section.second")
	content_2.style.display = "none";

	let content_3 = document.querySelector("section.three")
	content_3.style.display = "block";
}


function teamEdit(){
	window.location.href = `../my team/myteamedit.html?unique_id=${phonenumber}&team_id=${team_id}`;
	
}

const team_image = document.createElement("img");
team_image.setAttribute("src", teamProfile["teamImageUrl"]);
team_image.setAttribute("alt", "logo of " + teamProfile["teamName"] );
document.querySelector(".playerimagediv").prepend(team_image);

const team_background_image = document.createElement("img");
team_background_image.setAttribute("class", "bgimg")
team_background_image.setAttribute("src", teamProfile["teamImageUrl"]);
team_background_image.setAttribute("alt", "logo of " + teamProfile["teamName"]);
document.querySelector("header").prepend(team_background_image);

let teamUserName = teamProfile["teamName"]
document.querySelector(".profiledetailsdiv h1").innerHTML = teamUserName;

let teamLocation = teamProfile["address"]["area"]
document.querySelector(".profiledetailsdiv div:nth-child(2) p").innerHTML = teamLocation;

let teamSince = moment(teamProfile["dateOfJoin"])

document.querySelector(".profiledetailsdiv div:nth-child(3) p").innerHTML = "Since" + "  " +teamSince.format("MMM Do YY");

let teamArea = teamProfile["address"]["area"]
document.querySelector(".area").innerHTML = teamArea ;

let teamAge = min + " - " + max;
document.querySelector(".age").innerHTML = teamAge ;

let teamAbout = teamProfile["about"]
document.querySelector(".about").innerHTML = teamAbout ;

if(teamProfile["openForPlayers"]["status"]){
	let teamOpenForPlayer = teamProfile["openForPlayers"]["description"]
document.querySelector(".open_for_player").innerHTML = teamOpenForPlayer ;
}
else{
	let teamOpenForPlayer = teamProfile["openForPlayers"]["description"]
document.querySelector(".open_for_player").innerHTML = "They did Not want any players" ;
}

let teamMemberCount = teamProfile["teamMembers"].length
document.querySelector(".member").innerHTML = teamMemberCount  ;

function previousPage(){
	window.history.go(-1)
}

</script>
<script src="../../assets/js/past_match.js"></script>
</body>
</html>