<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Home page for newmember</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="../../assets/css/profileview.css">
</head>

<body>

	<!-- header start -->
	<header>
		<!-- <img class="bgimg" src="../../assets/images/team1profile.jpg" alt="backgroundimage"> -->
		<div class="color"></div>
		<div class="top">
			<a onclick="previousPage()"><i class="fa-solid fa-arrow-left"></i></a>
			<div class="topleft">
				<i class="fa-solid fa-share"></i>
				<a onclick="teamEdit()" class="edit_team"><i class="fa-solid fa-pen"></i></a>
				<i class="fa-brands fa-whatsapp"></i>
			</div>
		</div>
		<div class="sidebar-profile">
				<div class="playerimagediv">
					<!-- <img src="../../assets/images/team1profile.jpg" alt="teamprofile"> -->
				</div>
				<div class="profiledetailsdiv">
					<h1></h1>
					<div>
						<i class="fa-solid fa-location-dot"></i>
						<p></p>
					</div>
					<div>
						<i class="fa-regular fa-calendar"></i>
						<p></p>
					</div>
				</div>
			</div>
	</header>
	<!-- header end -->
		<!-- main start -->
		<main>
			<div class="headerbottom">

				<button  type="button" onclick="member()">MEMBER</button>

				<button type="button" onclick="match()">MATCHES</button>

				<button type="button" onclick="profile()">PROFILE</button>
			<div class="button_underline"></div>
		</div>
		<section class="first">
			<div class="playermatch">
			</div>
		</section>
	<!-- main start -->
	<section class="second">
		<div class="playermatch">

			<div class="teams">
				<div class="teamimagediv">
					<img class="teamprofile" src="../../assets/images/team profile image/team2profile.jpg" alt="teamprofile">
				</div>
				<div class="teamdetaildiv">
					<div>
						<div><p>vs</p><h2>Avengers11</h2></div>
						<div>
							<i class="fa-regular fa-clock"></i>
							<p>2-Dec-2022,15:30</p></div>
					</div>
					<div class="matchdetails"><i class="fa-solid fa-location-dot"></i>
						<p>Chennai, Annanagar</p></div>

						<div class="matchdetails"><i class="fa-solid fa-circle-info"></i>
							<p>Betting match, Rubberball match</p></div>	
				</div>
			</div>

			<div class="teams">
				<div class="teamimagediv">
					<img class="teamprofile" src="../../assets/images/team profile image/team3profile.jpg" alt="teamprofile">
				</div>
				<div class="teamdetaildiv">
					<div>
						<div><p>vs</p><h2>Warriors</h2></div>
						<div>
							<i class="fa-regular fa-clock"></i>
							<p>2-Dec-2022,08:30</p></div>
					</div>
					<div class="matchdetails"><i class="fa-solid fa-location-dot"></i>
						<p>Chennai, Annanagar</p></div>

						<div class="matchdetails"><i class="fa-solid fa-circle-info"></i>
							<p>Betting match, Rubberball match</p></div>	
				</div>
			</div>

			<div class="teams">
				<div class="teamimagediv">
					<img class="teamprofile" src="../../assets/images/team profile image/team4profile.jpg" alt="teamprofile">
				</div>
				<div class="teamdetaildiv">
					<div>
						<div><p>vs</p><h2>Madmax11</h2></div>
						<div>
							<i class="fa-regular fa-clock"></i>
							<p>1-Dec-2022,15:30</p></div>
					</div>
					<div class="matchdetails"><i class="fa-solid fa-location-dot"></i>
						<p>Chennai, Annanagar</p></div>

						<div class="matchdetails"><i class="fa-solid fa-circle-info"></i>
							<p>Friendly match, Rubberball match</p></div>	
				</div>
			</div>

			<div class="teams">
				<div class="teamimagediv">
					<img class="teamprofile" src="../../assets/images/team profile image/team5profile.jpg" alt="teamprofile">
				</div>
				<div class="teamdetaildiv">
					<div>
						<div><p>vs</p><h2>Wonder11</h2></div>
						<div>
							<i class="fa-regular fa-clock"></i>
							<p>24-Nov-2022,15:30</p></div>
					</div>
					<div class="matchdetails"><i class="fa-solid fa-location-dot"></i>
						<p>Chennai, Annanagar</p></div>

						<div class="matchdetails"><i class="fa-solid fa-circle-info"></i>
							<p>Betting match, Rubberball match</p></div>	
				</div>
			</div>

			<div class="teams">
				<div class="teamimagediv">
					<img class="teamprofile" src="../../assets/images/team profile image/team6profile.png" alt="teamprofile">
				</div>
				<div class="teamdetaildiv">
					<div>
						<div><p>vs</p><h2>Asgard</h2></div>
						<div>
							<i class="fa-regular fa-clock"></i>
							<p>23-Nov-2022,15:30</p></div>
					</div>
					<div class="matchdetails"><i class="fa-solid fa-location-dot"></i>
						<p>Chennai, Annanagar</p></div>

						<div class="matchdetails"><i class="fa-solid fa-circle-info"></i>
							<p>Betting match, Rubberball match</p></div>	
				</div>
			</div>
		</div>
	</section>
	<section class="three">
		
		<div class="playerprofile">
			<table class="data">
				<caption></caption>
						<thead>
							<th>
								<td></td>
								<td></td>
								<td></td>
							</th>
						</thead>
			<tbody>
				<tr>
					<td>Area</td>
					<td class="area"></td>
				  </tr>
				  <tr>
					<td>Age</td>
					<td class="age"></td>
				  </tr>
				  <tr>
					<td>Members</td>
					<td class="member"></td>
				  </tr>
				  <tr>
					<td>About</td>
					<td class="about"></td>
				  </tr>
				  <tr>
					<td>Open for players</td>
					<td class="open_for_player"></td>
				  </tr>
			</tbody>
		  </table>
		</div>
		</section>
	</main>
	<!-- main end -->

	<script src="../../lib/moment/moment.min.js">

	</script>

<script>


const queryString = window.location.search;

const urlParams = new URLSearchParams(queryString);

const phonenumber = urlParams.get('unique_id');

let unique_id = phonenumber;

let team_list = JSON.parse(localStorage.getItem('team_details_list'));

let all_player_list = JSON.parse(localStorage.getItem('user_detail'));

function findPlayer(a) {
let index = a.teamMembers.indexOf(unique_id);
return a.teamMembers[index] == unique_id ;
}

let teamProfile = team_list.find(findPlayer);

let team_id = teamProfile["uniqueId"]

let unique_player = teamProfile["teamMembers"];

let players_list = []

for(i=0;i<unique_player.length;i++){

	let player_number = unique_player[i];

	function findPlayer(a) {
	return a.phoneNumber == player_number ;
	}	

	let player_object = all_player_list.find(findPlayer);

	players_list.push(player_object)

}

let my_profile = players_list.find(e => e.phoneNumber == unique_id)

console.log(my_profile)
if(my_profile["captainStatus"] == 0){
	document.querySelector(".edit_team").style.display = "none";
}

let players_age =[]

console.log(players_list)

for(i=0;i<players_list.length;i++){

let captain = "" ;
let whatsapp = "";
let me = ""

if(players_list[i]["captainStatus"] == 1){
	captain = "captain"
}
if(players_list[i]["phoneNumber"] == phonenumber && players_list[i]["captainStatus"] == 1){
    whatsapp = "";
	me = "(you)"
}

else if(players_list[i]["phoneNumber"] != phonenumber){
	whatsapp = '<i class="fa-brands fa-whatsapp"></i>'
}

else{
	whatsapp = '<a class="exit_from_team" onclick="exit()">EXIT</a>'
	me = "(you)"
}

let playerAge = players_list[i]["dateOFBirth"]
let dob = new Date(playerAge);
        let today = new Date();
        let age = today.getTime() - dob.getTime();
        age = Math.floor(age / (1000 * 60 * 60 * 24 * 365.25));
		players_age.push(age)

	const player = players_list[i];
	const template1 = renderPlayer(player, captain, whatsapp, me, age);
	document.querySelector(".playermatch").insertAdjacentHTML("beforeend", template1);

}

// here i find max and min of players of the age 

let max = Math.max(...players_age)
let min  = Math.min(...players_age)


function renderPlayer(player, captain, whatsapp, me, age) {  

const template1 = `	
	<div class="teams">
					<div class="teamimagediv">
						<img class="teamprofile playerimg" src="${player["imageUrl"]}" alt="Image of ${player["userName"]}">
					</div>
					<div class="teamdetaildiv playerdet">
						<div>
							<div><p class="playername">${player["userName"]}<b>${me} ${captain}</b></p></div>
							<div class="whatsapp">
								${whatsapp}
								</div>
						</div>
						<div class="matchdetails"><i class="fa-solid fa-calendar-week"></i>
							<p>${age}</p></div>
	
					</div>
				</div>
	`
return template1;
}


function exit(){
	if(confirm("Do you want to Exit from " + teamProfile["teamName"] + " team ?")){

		let my_profile = all_player_list.find(e => e.phoneNumber == phonenumber)

		my_profile["captainStatus"] = 2 ;

		let indexOfUser = teamProfile["teamMembers"].indexOf(my_profile["phoneNumber"]);

		teamProfile["teamMembers"].splice(indexOfUser, 1);

		localStorage.setItem('user_detail', JSON.stringify(all_player_list));
		localStorage.setItem('team_details_list', JSON.stringify(team_list));

		window.location.href = `../homepage/hpexist.html?unique_id=${phonenumber}`
	}
}

function member(){
    let toggle_button = document.querySelector(".button_underline");
	toggle_button.style.left = "0%";
    console.log("hi")

	let content_1 = document.querySelector("section.first")
	content_1.style.display = "block";

	let content_2 = document.querySelector("section.second")
	content_2.style.display = "none";

	let content_3 = document.querySelector("section.three")
	content_3.style.display = "none";
}
function match(){
    let toggle_button = document.querySelector(".button_underline");
	toggle_button.style.left = "33.3%";
	
	let content_1 = document.querySelector("section.first")
	content_1.style.display = "none";

	let content_2 = document.querySelector("section.second")
	content_2.style.display = "block";

	let content_3 = document.querySelector("section.three")
	content_3.style.display = "none";
}
function profile(){
    let toggle_button = document.querySelector(".button_underline");
	toggle_button.style.left = "66.6%";
	
	let content_1 = document.querySelector("section.first")
	content_1.style.display = "none";

	let content_2 = document.querySelector("section.second")
	content_2.style.display = "none";

	let content_3 = document.querySelector("section.three")
	content_3.style.display = "block";
}


function teamEdit(){
	window.location.href = `../my team/myteamedit.html?unique_id=${phonenumber}&team_id=${team_id}`;
	
}

const team_image = document.createElement("img");
team_image.setAttribute("src", teamProfile["teamImageUrl"]);
team_image.setAttribute("alt", "logo of " + teamProfile["teamName"] );
document.querySelector(".playerimagediv").prepend(team_image);

const team_background_image = document.createElement("img");
team_background_image.setAttribute("class", "bgimg")
team_background_image.setAttribute("src", teamProfile["teamImageUrl"]);
team_background_image.setAttribute("alt", "logo of " + teamProfile["teamName"]);
document.querySelector("header").prepend(team_background_image);

let teamUserName = teamProfile["teamName"]
document.querySelector(".profiledetailsdiv h1").innerHTML = teamUserName;

let teamLocation = teamProfile["address"]["area"]
document.querySelector(".profiledetailsdiv div:nth-child(2) p").innerHTML = teamLocation;

let teamSince = moment(teamProfile["dateOfJoin"])

document.querySelector(".profiledetailsdiv div:nth-child(3) p").innerHTML = "Since" + "  " +teamSince.format("MMM Do YY");

let teamArea = teamProfile["address"]["area"]
document.querySelector(".area").innerHTML = teamArea ;

let teamAge = min + " - " + max;
document.querySelector(".age").innerHTML = teamAge ;

let teamAbout = teamProfile["about"]
document.querySelector(".about").innerHTML = teamAbout ;

if(teamProfile["openForPlayers"]["status"]){
	let teamOpenForPlayer = teamProfile["openForPlayers"]["description"]
document.querySelector(".open_for_player").innerHTML = teamOpenForPlayer ;
}
else{
	let teamOpenForPlayer = teamProfile["openForPlayers"]["description"]
document.querySelector(".open_for_player").innerHTML = "They did Not want any players" ;
}

let teamMemberCount = teamProfile["teamMembers"].length
document.querySelector(".member").innerHTML = teamMemberCount  ;

function previousPage(){
	window.history.go(-1)
}

</script>
</body>
</html>