<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Home page for newmember</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
		integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
		integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="../../assets/css/overall.css">
	<link rel="stylesheet" href="../../assets/css/popup-team-profile.css">
	<link rel="stylesheet" href="../../assets/css/commonheader.css">
</head>

<body>
	<!-- header start -->
	<header>
		<i class="fa-solid fa-arrow-left"></i>
		<h1>Join with team</h1>
	</header>
	<!-- header end -->
	<!-- main start -->
	<section class="jointeammain">
		<div class="dummy-div"></div>
		<div class="content join-team-content">
			
			<div class="content-subheader searchbardiv">
				<div class="searchbar"><input type="search"><i class="fa-solid fa-magnifying-glass"></i></div>
			</div>

		</div>
	</section>
	<!-- main end -->
	<!-- popup content start -->
	<div class="popup" id="popup">

		<div class="popup-team-content">
			<button class="backbtn" type="button" onclick="ClosePopup()"><i
					class="fa-regular fa-circle-xmark"></i></button>
			<h2></h2>
			<div class="popup-team-area">
				<div>
					<i class="fa-solid fa-location-dot"></i>
					<p class="popup_area_name"></p>
				</div>
				<div >
					<i class="fa-regular fa-clock"></i>
					<p class="popup_since"></p>
				</div>
			</div>
			
			<h3 class="popup_member_count"></h3>
			<div class="players-list">
				
			</div>

			<a href="../profile/teammember.html"><button class="profile-view-btn">VIEW PROFILE</button></a>
		</div>
	</div>

	<!-- popup content end -->
	<!--script for popup start-->
	<script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js"></script>
	<script src="../../lib/moment/moment.min.js"></script>
	<script>
		
// team card div start
		// for (i = 0; i <= jointeam.length; i++) {

		// 	// team popup details start
		// 	for (j = 0; j < jointeam[i]["teamMembers"].length; j++) {

		// 		const player = jointeam[i]["teamMembers"][j]
		// 		const div_team_players = renderPlayer(player)

		// 		document.querySelector("div.players-list").append(div_team_players)
		// 	}
		// 	// team popup details end

		// 	const div_teams = document.createElement("div");
		// 	div_teams.setAttribute("class", "teams");

		// 	const team_image_div = document.createElement("div");
		// 	team_image_div.setAttribute("class", "teamimagediv");
		// 	div_teams.append(team_image_div);

		// 	const team_image_button = document.createElement("button");
		// 	team_image_button.setAttribute("type", "button");
		// 	team_image_button.setAttribute("onclick", "OpenPopup()");
		// 	team_image_div.append(team_image_button);

		// 	const team_image = document.createElement("img");
		// 	team_image.setAttribute("class", "teamprofile");
		// 	team_image.setAttribute("src", jointeam[i]["teamImage"]["source"]);
		// 	team_image.setAttribute("alt", jointeam[i]["teamImage"]["alt"]);
		// 	team_image_button.append(team_image);

		// 	const team_details_div = document.createElement("div");
		// 	team_details_div.setAttribute("class", "teamdetaildiv");
		// 	div_teams.append(team_details_div);

		// 	const team_details_subdiv1 = document.createElement("div");
		// 	team_details_div.append(team_details_subdiv1);

		// 	const team_name_button = document.createElement("button");
		// 	team_name_button.setAttribute("type", "button");
		// 	team_name_button.setAttribute("onclick", "OpenPopup()");
		// 	team_details_subdiv1.append(team_name_button);

		// 	const team_name_button_div1 = document.createElement("div");
		// 	team_name_button.append(team_name_button_div1);

		// 	const team_name_header = document.createElement("h2");
		// 	team_name_header.innerText = jointeam[i]["teamName"];
		// 	team_name_button_div1.append(team_name_header);

		// 	const team_name_button_div2 = document.createElement("div");
		// 	team_name_button.append(team_name_button_div2);

		// 	const icon_location = document.createElement("i");
		// 	icon_location.setAttribute("class", "fa-solid fa-location-dot");
		// 	team_name_button_div2.append(icon_location);

		// 	const area_name_para = document.createElement("p");
		// 	area_name_para.innerText = jointeam[i]["address"]["area"];
		// 	team_name_button_div2.append(area_name_para);

		// 	const team_details_subdiv2 = document.createElement("div");
		// 	team_details_div.append(team_details_subdiv2);

		// 	const icon_handshake = document.createElement("i");
		// 	icon_handshake.setAttribute("class", "fa-regular fa-handshake");
		// 	team_details_subdiv2.append(icon_handshake);

		// 	const open_for_players_details_para = document.createElement("p");
		// 	open_for_players_details_para.innerText = jointeam[i]["openForPlayers"];
		// 	team_details_subdiv2.append(open_for_players_details_para);

		// 	const select_link = document.createElement("i");
		// 	select_link.setAttribute("class", "select-link");
		// 	select_link.setAttribute("href", "#");
		// 	select_link.innerText = "SELECT";
		// 	div_teams.append(select_link);


		// 	document.querySelector(".join-team-content").append(div_teams)

		// }
		// team card div end 



	let jointeam = (JSON.parse(localStorage.getItem('team_details_list'))).filter(e => e.openForPlayers["status"] == true);


		function renderTeam(team) {
			const template = `
			<div class="teams">
				<div class="teamimagediv popup-name" data-id="${team["teamName"]}">
					<img class="teamprofile"
							src="${team["teamImageUrl"]}" alt="logo of ${team["teamName"]}">
				</div>
				<div class="teamdetaildiv">
					<div>
						
							<div class="popup-name" data-id="${team["teamName"]}">
								<h2>${team["teamName"]}</h2>
							</div>
							<div>
								<i class="fa-solid fa-location-dot"></i>
								<p>${team["address"]["area"]}</p>
							</div>
						
					</div>
					<div>
						<i class="fa-regular fa-handshake"></i>
						<p>${team["openForPlayers"]["description"]}</p>
					</div>
				</div>
				<p class="select-link" data-id="${team["teamName"]}">SELECT</p>
			</div>
			`
			return template;
		}


for (let index = 0; index < jointeam.length; index++) {

	const team = jointeam[index];
	const template = renderTeam(team);


	document.querySelector(".join-team-content").insertAdjacentHTML("beforeend", template)

}

// function for team members display in popup start
function renderPlayer(player) {  
const template1 = `	
<div>
		<img class="players-list-image" src="${player["imageUrl"]}" alt="Image of ${player["userName"]}">
		<p>${player["userName"]}</p>
	</div>
	`
return template1;
}


// response create start

let selectbtn = document.querySelectorAll(".select-link");
	selectbtn.forEach(each => {
      each.addEventListener("click", (event) => {
		const person_data = jointeam.find(book => book["teamName"] === each.dataset.id);

		let user_data = JSON.parse(localStorage.getItem('user_data'));

		let response_unique_id = uuidv4();	
		team_unique_id = person_data["uniqueId"],
		player_unique_id = user_data["phoneNumber"],
		created_time = moment();

		let response_list = JSON.parse(localStorage.getItem('response_list'))||[] ;

		let response_details = {
			"responseUniqueId" : response_unique_id,
			"playerUniqueId" : player_unique_id,
			"teamUniqueId" : team_unique_id,
			"createdTime" : created_time,
			"requestStatus" : ""
		}

		response_list.push(response_details);
        
        localStorage.setItem('response_list', JSON.stringify(response_list));

    	window.location.href = "./response.html";

	  })
	})


// response create end

// onclick button 

const bookCovers = document.querySelectorAll(".popup-name");
    bookCovers.forEach(bookCover => {
      bookCover.addEventListener("click", (event) => {
        const person_data = jointeam.find(book => book["teamName"] === bookCover.dataset.id);
		let popup = document.getElementById("popup");
			popup.classList.add("open-popup");// hear we add class for show popup
			//  hear we work for display team member repeat pattern 
			document.querySelector(".players-list").innerHTML = ""

			// find players in there team start

			let all_player_list = JSON.parse(localStorage.getItem('user_detail'));

			let unique_player = person_data["teamMembers"];


			let players_list = []

			for(i=0;i<unique_player.length;i++){

				let player_number = unique_player[i];

				function findPlayer(a) {
				return a.phoneNumber == player_number ;
				}	

				let player_object = all_player_list.find(findPlayer);

				players_list.push(player_object)

			}


			// find players in there team end


			for (let index = 0; index < players_list.length; index++) {

			const player = players_list[index];
			const template1 = renderPlayer(player);
			document.querySelector(".players-list").insertAdjacentHTML("beforeend", template1)

				}
			// popup team content 
			let popup_team_name = document.querySelector("div.popup-team-content h2");
			popup_team_name.innerHTML = person_data["teamName"];

			let popup_area_name = document.querySelector("p.popup_area_name");
			popup_area_name.innerHTML = person_data["address"]["area"] + ",  " + person_data["address"]["distric"];
			
			let popup_since = document.querySelector("p.popup_since");
			popup_since.innerHTML = "Since  " + person_data["dateOfJoin"];

			let popup_member_count = document.querySelector("h3.popup_member_count");
			popup_member_count.innerHTML = "Members (" + person_data["teamMembers"].length +")" ;

	
      })
    })
				
function ClosePopup() {
	popup.classList.remove("open-popup");
}

// function for team members display in popup end
	</script>


</body>

</html>

